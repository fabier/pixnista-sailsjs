<%title=post.title%>
<div class="container" ng-cloak>
    <div class="row">
        <div class="col-md-4">
            <div class="row">
                <div class="col-md-12">
                    <img src="/image/show/<%=post.images[0].id%>" style="width:100%;"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <small class="text-muted">
                        <%=post.creator.name%> <%= moment(post.createdAt).calendar() %>
                    </small>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <%if(post.creator.avatarUrl){%>
                    <img class="post-creator-avatar" src="<%=post.creator.avatarUrl%>"/>
                    <%} else {%>
                    <img class="post-creator-avatar" src="/images/user-avatar.png"/>
                    <%}%>
                    <h4>
                        <%=post.creator.name%>
                        <%if(post.creator.description){%>
                        <br/>
                        <small>
                            <%=post.creator.description%>
                        </small>
                        <%}%>
                    </h4>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="row">
                <h2>
                    <%=post.title%>
                    <% if (post.content !== undefined) {%>
                    <br/>
                    <small>
                        <%=post.content%>
                    </small>
                    <% } %>
                </h2>
            </div>
            <% var postComments = _.sortBy(post.postComments, 'createdAt').reverse(); %>
            <%if(postComments.length === 0){%>
            <p class="post-nocomment">Pas de commentaires pour cette demande d'aide.</p>
            <%}else{%>
            <% postComments.forEach(function(postComment){ %>
            <% include ../postComment/show %>
            <% }) %>
            <%}%>
            <div class="row" ng-controller="CreatePostCommentController">
                <form id="postComment-form" ng-submit="submitPostCommentForm()" class="form-horizontal">
                    <h4>Ajouter un commentaire</h4>
                    <div class="form-group">
                        <div class="col-sm-10">
                            <textarea id="comment" name="comment" ng-model="postCommentForm.comment" rows="5" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-primary">
                                <span ng-show="!postCommentForm.creating">Publier un commentaire</span>
                                <span ng-show="postCommentForm.creating" class="fa fa-spinner"></span>
                                <span ng-show="postCommentForm.creating">Publication en cours...</span>
                            </button>
                        </div>
                    </div>
                    <input type="hidden" id="postId" name="postId" value="<%=post.id%>"/>
                </form>
            </div>
        </div>
    </div>
</div>
